<!-- front-matter
id: watch
title: watch()
hide_title: true
sidebar_label: watch()
-->

# watch()

Позволяет просматривать глобы и запускать задачу при изменении. Задачи обрабатываются одинаково с остальной частью системы задач.

## Применение

```js
const { watch } = require('gulp');

watch(['input/*.js', '!input/something.js'], function(cb) {
  // тело опущено
  cb();
});
```

## Подпись

```js
watch(globs, [options], [task])
```

### Параметры

| параметр | тип | примечание |
|:--------------:|:-----:|--------|
| globs<br />**(required)** | string<br />array | [Globs][globs-concepts] для просмотра файловой системы. |
| options | object | Подробнее в [Опциях][options-section] ниже. |
| task | function<br />string | [Функция задачи][tasks-concepts] или составная задача - создается с помощью `series()` и `parallel()`. |

### Возвращается

Экземпляр [chokidar][chokidar-instance-section] для детального управления настройкой наблюдения.

### Ошибки

Когда не-строка или массив с любыми не-строками передается как `globs`, выдает ошибку с сообщением: "Non-string provided as watch path".

Когда строка или массив передается как `task`, выдает ошибку с сообщением: "watch task has to be a function (optionally generated by using gulp.parallel or gulp.series)".

### Опции

| наименование | тип | по умолчанию | примечание |
|:-------:|:------:|-----------|--------|
| ignoreInitial | boolean | true | Если `false`, задача вызывается во время создания экземпляра при обнаружении путей к файлам. Используется для запуска задачи во время запуска.<br />**Примечание:** Эта опция передается в [chokidar][chokidar-external], но по умолчанию имеет значение `true`, а не `false`. |
| delay | number | 200 | Задержка в миллисекундах между изменением файла и выполнением задачи. Позволяет дождаться многих изменений перед выполнением задачи, например найти и заменить многие файлы. |
| queue | boolean | true | Если задано значение true и задача уже запущена, любые изменения файла будут помещены в очередь на выполнение одной задачи. Предотвращает перекрытие длительных задач. |
| events | string<br />array | [ 'add',<br />'change',<br />'unlink' ] | Наблюдаемые события для запуска выполнения задачи. Может быть `'add'`, `'addDir'`, `'change'`, `'unlink'`, `'unlinkDir'`, `'ready'` и/или `'error'`. Дополнительно доступен `'all'`, который представляет все события, кроме `'ready'` и `'error'`.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| persistent | boolean | true | Если `false`, наблюдатель не будет поддерживать работу Node-процесса. Отключать эту опцию не рекомендуется.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| ignored | array<br />string<br />RegExp<br />function |  | Определяет игнорируемые globs. Если функция предоставлена, она будет вызываться дважды для каждого пути - один раз только с путем, затем с путем и объектом `fs.Stats` этого файла.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| followSymlinks | boolean | true | Если установлено значение `true`, изменения как в символических ссылках, так и в связанных файлах вызывают события. Если `false`, изменения запускают только символические ссылки.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| cwd | string |  | Каталог, который будет объединен с любым относительным путем, чтобы сформировать абсолютный путь. Игнорируется для абсолютных путей. Используйте, чтобы избежать сочетания `globs` c `path.join()`.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| disableGlobbing | boolean | false | Если `true`, все `globs` обрабатываются как буквальные имена путей, даже если они содержат специальные символы.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| usePolling | boolean | false | Если установлено значение `false`, наблюдатель будет использовать `fs.watch()` (или [fsevents][fsevents-external] на Mac) для просмотра. Если `true`, используйте вместо этого опрос `fs.watchFile()` - он необходим для успешного просмотра файлов по сети или в других нестандартных ситуациях. Переопределяет значение по умолчанию `useFsEvents`.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| interval | number | 100 | Совместим с `usePolling: true`. Интервал опроса файловой системы.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| binaryInterval | number | 300 | Совместим с `usePolling: true`. Интервал опроса файловой системы для двоичных файлов.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| useFsEvents | boolean | true | Если установлено значение `true`, для просмотра использует fsevents, если таковая имеется. Если явно задано значение `true`, заменяет параметр `usePolling`. Если установлено значение `false`, для `usePolling` автоматически устанавливается значение `true`.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| alwaysStat | boolean | false | Если `true`, всегда вызывает `fs.stat()` для измененных файлов - замедлит просмотрщик файлов. Объект `fs.Stat` доступен только в том случае, если вы напрямую используете экземпляр chokidar.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| depth | number |  | Указывает, сколько уровней вложенности каталогов будет просматриваться.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| awaitWriteFinish | boolean | false | Не используйте эту опцию, используйте вместо нее `delay`.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| ignorePermissionErrors | boolean | false | Установите значение `true`, чтобы смотреть файлы, у которых нет разрешений на чтение. Затем, если просмотр не удастся из-за ошибок EPERM или EACCES, они будут автоматически пропущены.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |
| atomic | number | 100 | Активен, только если `useFsEvents` и `usePolling` имеют значение `false`. Автоматически отфильтровывает артефакты, возникающие при "атомарной записи" некоторыми редакторами. Если файл повторно добавлен в течение указанных миллисекунд после удаления, будет сгенерировано событие изменения - вместо отмены связи и последующего добавления.<br />_Эта опция передается напрямую [chokidar][chokidar-external]._ |

## Экземпляр Chokidar

Метод `watch()` возвращает базовый экземпляр [chokidar][chokidar-external], обеспечивая детальный контроль над настройкой ваших часов. Чаще всего используется для регистрации отдельных обработчиков событий, которые предоставляют `path` или `stats` измененных файлов.

**При прямом использовании экземпляра chokidar у вас не будет доступа к интеграции системы задач, включая асинхронное завершение, постановку в очередь и задержку.**

```js
const { watch } = require('gulp');

const watcher = watch(['input/*.js']);

watcher.on('change', function(path, stats) {
  console.log(`File ${path} was changed`);
});

watcher.on('add', function(path, stats) {
  console.log(`File ${path} was added`);
});

watcher.on('unlink', function(path, stats) {
  console.log(`File ${path} was removed`);
});

watcher.close();
```

`watcher.on(eventName, eventHandler)`

Регистрирует функции `eventHandler`, которые будут вызываться при наступлении указанного события.

| параметр | тип | примечание |
|:--------------:|:-----:|--------|
| eventName | string | Можно наблюдать следующие события: `'add'`, `'addDir'`, `'change'`, `'unlink'`, `'unlinkDir'`, `'ready'`, `'error'` или `'all'`. |
| eventHandler | function | Функция, вызываемая при наступлении указанного события. Аргументы подробно представлены в таблице ниже. |

| аргумент | тип | примечание |
|:-------------:|:-----:|--------|
| path | string | Путь к измененному файлу. Если была установлена опция `cwd`, путь будет относительным путем удаления `cwd`. |
| stats | object | Объект [fs.Stat][fs-stats-concepts], но может быть `undefined`. Если для параметра `alwaysStat` было установлено значение `true`, `stats` всегда будет предоставляться. |

`watcher.close()`

Завершает работу наблюдателя за файлами. После выключения больше не будут генерироваться события.

`watcher.add(globs)`

Добавляет дополнительные глобусы к уже запущенному экземпляру наблюдателя.

| параметр | тип | примечание |
|:-------------:|:-----:|--------|
| globs | string<br />array | Дополнительные globs, на которые следует обратить внимание. |

`watcher.unwatch(globs)`

Удаляет наблюдаемые глобсы, в то время как наблюдатель продолжает работу с оставшимися путями.

| параметр | тип | примечание |
|:-------------:|:-----:|--------|
| globs | string<br />array | Глобсы, которые нужно удалить. |

[chokidar-instance-section]: #chokidar-instance
[options-section]: #options
[tasks-concepts]: ../api/concepts.md#tasks
[globs-concepts]: ../api/concepts.md#globs
[fs-stats-concepts]: ../api/concepts.md#file-system-stats
[chokidar-external]: https://github.com/paulmillr/chokidar
[fsevents-external]: https://github.com/strongloop/fsevents
